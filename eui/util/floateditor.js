EUI.define("floateditor",function(t){"use strict";function i(t){this.dom=t,this.validator=null,this.hint=null,this.callback=null,this.context=null,this.args=null,this.value=null,this.isshow=!1}function s(s){i.call(this),s=s||document;var e=this.dom=s.body.appendChild(s.createElement("input"));e.style.cssText+="; position: absolute; width: 0; height: 0; left: -99999px; top: -99999px; padding: 0 4px; border: 1px solid #6A9AE6; background: #EDF2FD;",t.bind(e,"keydown",this,h)}function e(s){i.call(this),s=s||document;var e=this.dom=s.body.appendChild(s.createElement("textarea"));e.style.cssText+="; position: absolute; width: 0; height: 0; left: -99999px; top: -99999px; padding: 0 4px; border: 1px solid #6A9AE6; background: #EDF2FD;",t.bind(e,"keydown",this,h)}function o(s){i.call(this),t.isObject(s)?(this.htmls=c(this.values=[],s.options),s=s.doc||document):s=s||document,(this.dom=s.body.appendChild(s.createElement("div"))).style.cssText+="; position: absolute; width: 0; height: 0; left: -99999px; top: -99999px; padding: 0; background: #FFF;",this.htmls&&(this.dom.innerHTML=this.htmls,this.select=this.dom.firstChild)}t.extend(i.prototype,{dispose:function(){this.dom.parentNode.removeChild(this.dom),this.dom=null,this.validator=null,this.hint=null,this.callback=null,this.context=null,this.args=null,this.value=null,this.isshow=null},getDom:function(){return this.dom},getValue:function(){return this.value},show:function(i,s,e,o,n){this.value=i,1===s.nodeType&&(s=t.getRect(s));var l=s.left,h=s.top;this.dom.style.cssText+="; left: "+l+"px; top: "+h+"px; width: "+(s.width||right-l)+"px; height: "+(s.height||bottom-h)+"px;",!e||t.isFunction(e)?(this.callback=e,this.context=null,this.args=null):(this.callback=e.callback,this.context=e.context,this.args=e.args),this.validator=!(!t.isFunction(o)&&!o.test)&&o,this.hint=n,this.isshow=!0},hide:function(i){if(this.isshow){if(!i){var s=this.getValue();if(s!==this.value){if(s&&this.validator&&!1===(this.validator.test?this.validator.test(s):this.validator(s)))return!1===i&&(this.isshow=!1,this.dom.style.cssText+="; left: -99999px; top: -99999px;"),!1;t.isFunction(this.callback)&&this.callback.apply(this.context,[s].concat(this.args))}}this.isshow=!1,this.dom.style.cssText+="; left: -99999px; top: -99999px;"}}});var n={},l={input:s,textarea:e,select:o};t.unload(function(){for(var t in n)n[t].dispose()}),t.extend(i,{registEditor:function(i,s){i&&t.isString(i)&&t.isFunction(s)&&(l[i]=s)},getEditor:function(i,s){var e=n[i=i||"input"];if(!e){var o=/^(\w+)(?:\.\w+)?$/.exec(i);if(null==o)return t.error("ID不合法，获取浮动编辑器失败.");if(!(e=l[o=o[1]]))return t.error("类型【"+o+"】未注册，获取浮动编辑器失败.");e=n[i]=new e(s)}return e}});var h=function(i){switch(i.keyCode){case t.KEY_ENTER:i.shiftKey||i.data.hide();break;case t.KEY_ESC:i.data.hide(!0)}};t.inherit(s,i,{dispose:function(){t.unbind(this.dom),i.prototype.dispose.call(this)},getValue:function(){return this.dom.value},show:function(t,i,e,o,n){s._superClass.prototype.show.apply(this,arguments),this.dom.value=t,this.dom.focus()}}),e.EXT_SIZE=50,t.inherit(e,s,{show:function(i,s,o,n,l){1===s.nodeType&&(s=t.getRect(s));var h=s.top,a=s.bottom,u=t.getRect(this.dom.parentNode),c=u.bottom,r=a+e.EXT_SIZE;c>r?s.bottom=r:s.top=Math.max(0,h-e.EXT_SIZE),e._superClass.prototype.show.call(this,i,s,o,n,l)}});var a=function(t,i,s,e){t.push('<option value="',e,'">',s,"</option>"),i.push(e)},u=function(t,i,s,e,o,n,l){!1!==o.apply(n,[s,e].concat(l))&&a(t,i,s,e)},c=function(i,s,e,o,n){var l=['<select style="width:100%;height:100%;border: 1px solid #CCC;">'],h=t.isFunction(e)?u:a;if(t.isArray(s))for(var c=0,r=s.length;c<r;c++){var d=s[c];d.value;h(l,i,d.name||d,d.value||d,e,o,n)}else for(var c in s)h(l,i,s[c],c,e,o,n);return l.push("</select>"),l.join("")};return t.inherit(o,i,{dispose:function(){o._superClass.prototype.dispose.call(this),this.htmls=null,this.values=null},getValue:function(){var t=this.select?this.select.selectedIndex:-1;return-1===t?"":this.values[t]},initOptions:function(i,s,e,o){t.isFunction(i)&&(i=i.apply(e,[].concat(o)));var n=c(this.values=[],i,s,e,o);this.htmls!==n&&(this.dom.innerHTML=this.htmls=n,this.select=this.dom.firstChild)},show:function(t,i,s,e,n){this.select&&(this.select.selectedIndex=this.values.indexOf(t+"")),o._superClass.prototype.show.apply(this,arguments),this.select.focus()}}),i});