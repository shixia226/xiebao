EUI.defineCmp("list",["relayout","floateditor"],function(e,t,r){"use strict";function a(e){e=r.extend({},i,e),e.data$index&&a.options4index(e),e.data$check&&a.options4check(e),a._superClass.call(this,e);var t=this._property;r.extend(t,{datakey:e.datakey||"id",enableedit:!1,enableselect:!0,selectedrows:[],selectedidxs:[],selectmultiple:!1,selectautoclear:!0,cls_hover:e.cls_hover,cls_even:e.cls_even,extrowstyles:[]}),this.enableEdit(e.enableedit),this.enableSelected(e.enableselect,e.multiple,e.autoclear),this.setHeaderVisible(e.headervisible),this.setOnSelect(e.onselect,e.args4select);var l=e.datas;l&&this.add(l),this.layout(!1)}var i={cls_hover:"ui-list-hover",cls_even:"ui-list-even",height:"",uievents:{click:function(e){var t=e.target,a=e.data,i=a._property,l=i.editor;if((!l||!r.isAncestor(l.getDom(),t,!0)&&!1!==l.hide())&&!1!==a.emit("click",e)){for(var s=[];t!==this;)1===t.nodeType&&s.push(t),t=t.parentNode;s.pop();if(s.pop()===i.dataTable){var n=s.pop();if(n&&"tr"!==n.tagName.toLowerCase()&&(n=s.pop()),n){var d=s.pop(),o=d.cellIndex,c=i.headers[o],h=n.rowIndex;if(l=c.editor){var u,f=c.name,p=i.datas[h],v=p[i.datakey],_=i.editdatas[v];_&&!r.isNull(u=_[f])||(u=p[f]),r.isNull(u)&&(u="");var g=c.onshoweditor;if(g){var y=g.apply(l,[h,o,a].concat(c.args4showeditor));y&&(c.texts=y)}for(var w=d.lastChild;w&&!r.hasClass(w,"ui-list-edittext");)w=w.previousSibling;(i.editor=l).show(u,w||d,{callback:a.setData,context:a,args:[h,o]},c.validator,c.hint)}else!1!==a.emit("clickcell",e,o,h)&&a.setSelected(h);return}}a.setSelected()}},dataContainer:{scroll:function(e){var t=e.data,r=t._property;if(r.__keepeditonce)return r.__keepeditonce=!1,!1;var a=r.editor;a&&(a.hide(!1),r.editor=null),r.headerContainer.scrollLeft=this.scrollLeft}}},onContainerInit:function(e,t){},onComponentInit:function(e,a,i){var s=e.appendChild(a.createElement("div"));s.className="ui-list";var n=i.cls_container;r.addClass(s,n),s.innerHTML='<div class="ui-list-header"><table class="ui-list-header-table"></table></div><div class="ui-list-data"><table class="ui-list-data-table"><colgroup></colgroup><tbody></tbody></table></div>';for(var d=s.firstChild,c=d.firstChild,h=s.lastChild,u=h.firstChild,f=c.insertRow(-1),p=u.firstChild,v=i.headers||[],_=[],g=null,y=null,w=null,b=null,C=null,x=null,m=null,N=null,k=null,T=[],S=0,I=0,E=v.length-1;I<=E;I++){var F=v[I],O=f.insertCell(-1),D=p.appendChild(a.createElement("col"));if(O.className="ui-list-header-cell",g=l(F.width),""!==g&&g>=0?(S+=y=g,O.style.width=D.style.width=y+"px"):y=0,w=F.caption||"",r.isFunction(C=F.renderheader)?C(O,w,F,I,a,this,i):r.html(O,w),x=F.render,b=F.texts,!0===F.editable){if(r.isFunction(x)||!1===x||(x=o),m=F.editor){if(r.isString(m)){var P=F.args4editor;P?P.doc=a:P=b?{options:b,doc:a}:a,m=t.getEditor(m,P)}}else m=t.getEditor(null,a);k=F.validator,k?r.isString(k)?k=F.validator=r.parseReg(k):r.isFunction(k)||k.test||(k=F.validator=!1):k=!1,N=F.onshoweditor,r.isFunction(N)||(N=!1)}else r.isFunction(x)||(x=!1),!0===F.refresh&&T.push(I),m=!1,k=!1,N=!1;_.push({name:F.name||"",caption:w,width:g,minwidth:parseInt(F.minwidth,10)||0,realwidth:y,render:x,texts:b,editor:m,onshoweditor:N,args4showeditor:F.args4showeditor,validator:k,headerCell:O,dataCell:D})}return{container:s,refreshcols:T,datas:[],headervisible:!0,headers:_,sumwidth:S,headerContainer:d,headerTable:c,dataContainer:h,dataTable:u}},doHorizonLayout:function(){for(var e=this._property,t=e.headers,a=e.sumwidth,i=r.clientWidth(e.dataContainer),l=[],s=0,n=t.length-1;n>=0;n--){var d=t[n],o=d.width;if(""===o)l.push(n),(o=d.minwidth)!==d.realwidth&&(a+=d.realwidth-o,d.headerCell.style.width=d.dataCell.style.width=d.realwidth+"px");else if(o<0)a+=(o*=-i)-d.realwidth,d.headerCell.style.width=d.dataCell.style.width=(d.realwidth=o)+"px";else{0===s&&(s=n);var c=o-d.realwidth;0!==c&&(a+=c,d.headerCell.style.width=d.dataCell.style.width=(d.realwidth=o)+"px")}}if(e.sumwidth=a,a<i){var h=l.length;if(h>0)for(n=0;n<h;n++){var d=t[l[n]];d.headerCell.style.width=d.dataCell.style.width=""}else{var d=t[s];d.headerCell.style.width=d.dataCell.style.width=""}a=i}e.headerTable.style.width=e.dataTable.style.width=a+"px"}},l=function(e){if(r.isNull(e)||""===e||"auto"===e)e="";else if(r.isString(e)){var t=parseInt(e,10);e=t>0&&r.endWith(e,"%")?-t/100:t}else r.isNumber(e)||(e="");return e},s=function(e,t,a,i,l,s,n,d){i&&(a=i[a]||""),e?e(t,a,l,s,n,d):(r.clearNode(t),r.isNull(a)||""===a||t.appendChild(d.doc.createTextNode(a)))},n=function(e,t,a,i,l,n,d,o){var c=i.insertRow(l);a.splice(l,0,e),e[n]||(e[n]=r.random("datakey_")),c.className=o&&l%2==1?"ui-list-data-row":"ui-list-data-row "+o;for(var h=0,u=t.length;h<u;h++){var f=t[h],p=c.insertCell(-1),v=f.name;p.className="ui-list-data-cell",s(f.render,p,e[v],f.texts,v,h,l,this)}if(d)for(var h=d.length-1;h>=0;h--)d[h]>=l&&d[h]++;this.emit("ondataadd",l)},d=function(e,t,r,a,i,l,s){var n=t[e];if(n){if(r.deleteRow(e),t.splice(e,1),l)for(var d=l.length-1;d>=0;d--){var o=l[d];o===e?(l.splice(d,1),s.splice(d,1)):o>e&&(l[d]=o-1)}a&&delete a[n[i]]}},o=function(e,t,a,i,l,s){for(var n=e.lastChild;n&&"ui-list-edittext"!==n.className;)n=n.previousSibling;n?r.clearNode(n):(n=e.appendChild(s.doc.createElement("div")),n.className="ui-list-edittext"),r.isNull(t)||n.appendChild(s.doc.createTextNode(t))},c=function(e,t,a,i){for(var l=r.isFunction(e),s=!l&&r.isRegExp(e),n=0,d=t.length;n<d;n++){var o=t[n],c=null;if(i&&!r.isNull(c=i[o])||(c=a[o]),s){if(e.test(c))return!0}else if(l){if(!0===e(c,o))return!0}else if(c===e)return!0}return!1},h=function(e,t,a){var i=t.selectedidxs;if(-1===i.indexOf(a)){var l=t.dataTable.rows[a],s=t.onselect;s&&!1===s(a,l,!0,e,t.args4select)||(r.addClass(l,"ui-list-selected"),i.push(a),t.selectedrows.push(l))}},u=function(e,t,a){if(r.isNull(a)){for(var i=t.selectedrows,l=t.selectedidxs,s=null,n=t.onselect,d=null,o=null,c=0,h=i.length;c<h;c++)s=i[c],n&&!1===n(a,s,!1,e,t.args4select)?d?(d.push(l[c]),o.push(s)):(d=[l[c]],o=[s]):r.removeClass(s,"ui-list-selected");d?(t.selectedrows=o,t.selectedidxs=d):(i.length=0,l.length=0)}else{var l=t.selectedidxs;if(-1===(a=l.indexOf(a)))return;var u=t.selectedrows,s=u[a],n=t.onselect;if(n&&!1===n(a,s,!1,e,t.args4select))return;r.removeClass(s,"ui-list-selected"),l.splice(a,1),u.splice(a,1)}},f=function(e,t,a,i,l){var s=i.refreshcols,n=i.cls_even;if(s)for(var d=i.headers,o=i.datas;t<a;t++){for(var c=e[t],h=c.cells,u=o[t],f=0,p=s.length;f<p;f++){var v=s[f],_=d[v],g=_.name;_.render(h[v],u[g],g,v,t,l)}n&&(t%2==0?r.removeClass(c,n):r.addClass(c,n))}else if(n)for(;t<a;t++)t%2==0?r.removeClass(e[t],n):r.addClass(e[t],n)},p=function(e,t,a){r.addClass(t,a),e.push({row:t,style:a})},v=function(e,t){if(t)for(var a=0,i=e.length;a<i;a++){var l=e[a];if(l.row===t)return r.removeClass(t,l.style),void e.splice(a,1)}else{for(var a=0,i=e.length;a<i;a++){var l=e[a];r.removeClass(l.row,l.style)}e.length=0}},_="ui-icon font-icon-checkboxck",g="ui-icon font-icon-checkbox";return a.options4check=function(){var e=function(){var e=this.getSelected().length;this.getProperty("___checkboxall___").className=e?e===this.getCount()?_:"ui-icon font-icon-checkboxhfck":g},t=function(e){var t=e.data;if(t.getSelected().length===t.getCount())t.setSelected(!1),this.className=g;else{for(var r=0,a=t.getCount();r<a;r++)t.setSelected(!0,r);this.className=_}},a=function(t,a,i,l){a.cells[0].firstChild.className=i?_:g,r.timeout(e,{context:l,unique:!0});var s=l.getProperty("___onselect_before_check___");s&&s(t,a,i,l)},i=function(e,t){e.appendChild(t.createElement("span")).className=g;var r=e.appendChild(t.createElement("span"));return r.style.cssText+="; margin-left: 5px;",r},l=function(e,a,l,s,n,d,o){var c=i(e,n),h=c.previousSibling;c.appendChild(n.createTextNode(a)),r.bind(h,"mousedown.list",d,t),(o.props=o.props||{}).___checkboxall___=h,r.namespace(!0,"events.dispose",o,{callback:r.unbind,args:[h,"mousedown"]})},s=function(e,t,a,l,s,n){var d=n.doc,o=e.lastChild;o?r.clearNode(o):o=i(e,n.doc);var c=n.getProperty("___render_before_check___");c?c(o,t,a,l,s,n):o.appendChild(d.createTextNode(t))};return function(e){delete e.data$check,e.multiple=!0,e.autoclear=!1;var t=e.onselect;if(r.isFunction(t)){var i=e.props;i||(i=e.props={}),i.___onselect_before_check___=t}e.onselect=a;var n=e.headers;if(n&&0!==n.length){var d=n[0],o=d.render;if(r.isFunction(o)){var i=e.props;i||(i=e.props={}),i.___render_before_check___=o}d.renderheader=l,d.render=s,d.editable=!1}else n=e.headers=[{renderheader:l,render:s,editable:!1}]}}(),a.options4index=function(){var e=function(e,t,a,i,l,s){var n=s.getProperty("___render_before_index___");n?n(e,l+1,a,i,l,s):(r.clearNode(e),e.appendChild(s.doc.createTextNode(l+1)))};return function(t){delete t.data$index;var a=t.headers;if(a&&0!==a.length){var i=a[0],l=i.render;if(r.isFunction(l)){var s=t.data;s||(s=t.props={}),s.___render_before_index___=l}i.render=e,i.refresh=!0,i.editable=!1}else a=t.headers=[{render:e,refresh:!0,editable:!1}]}}(),r.inherit(a,e,{dispose:function(){},add:function(e,t){var a=this._property,i=a.headers,l=a.datas,s=a.datakey,d=a.dataTable,o=l.length,c=a.selectedidxs,h=a.cls_even;if((r.isNull(t)||isNaN(t)||t<0||t>o)&&(t=o),r.isArray(e)){var u=e.length;o+=u;for(var p=0;p<u;p++)n.call(this,e[p]||{},i,l,d,t++,s,c,h)}else o+=1,n.call(this,e||{},i,l,d,t++,s,c,h);return t<o&&f(d.rows,t,o,a,this),this.layout(),t-1},remove:function(e){var t=this._property,a=t.datakey;if(t.enableedit){var i=t._editConfig;if(i&&!1===i.obj.stop())return!1}var l=t.datas,s=t.dataTable,n=t.editdatas,o=t.selectedidxs,c=t.selectedrows;if(r.isNull(e)){if(r.isNull(o)||0===o.length)return;o=o.concat(),u(this,t),e=l.length-1;for(var h=o.length-1;h>=0;h--){var p=o[h];d(p,l,s,n,a,o,c),e=Math.min(e,p)}}else if(r.isString(e)){if(-1===(e=this.getIndex(e,a)))return;d(e,l,s,n,a,o,c)}else{if(e=parseInt(e),isNaN(e)||e<0||e>l.length)return;d(e,l,s,n,a,o,c)}t._hoverdatarow&&!t._hoverdatarow.parentNode&&(t._hoverdatarow=null),f(s.rows,e,l.length,t,this),this.layout()},clear:function(){var e=this._property;if(e.enableedit){var t=e._editConfig;if(t&&!1===t.obj.stop())return!1;e.editdatas={}}for(var r=e.dataTable,a=e.datas,i=a.length-1;i>=0;i--)r.deleteRow(i);a.length=0,e._hoverdatarow=null,e.enableselect&&(e.selectedrows.length=0,e.selectedidxs.length=0),this.layout()},refresh:function(e,t){if(e&&!1!==this.flushData()){var a=this._property,i=a.datakey;if(1===arguments.length){var l=e[i];if(!l||-1===(t=this.getIndex(l,i)))return}else if(-1===(t=this.getIndex.apply(this,Array.prototype.slice.call(arguments,1))))return;delete e[i];for(var n=a.headers,d=a.datas[t],o=a.dataTable.rows[t].cells,c=0,h=n.length;c<h;c++){var u=n[c],f=u.name,p=e[f];r.isNull(p)||(s(u.render,o[c],p,u.texts,f,c,t,this),d[f]=p)}}},getCount:function(){return this._property.datas.length},getData:function(e,t){this.stopEdit();var a=this._property;if(r.isArray(e)){var i=[],l=a.datas,s=a.editdatas,n=a.datakey;if(!0===t){s=s||{};for(var d=0,o=l.length;d<o;d++){for(var c=l[d],h=s[c[n]],u={},f=0,p=e.length;f<p;f++){var t=e[f];u[t]=h&&h.hasOwnProperty(t)?h[t]:c[t]}i.push(u)}}else if(s)for(var d=0,o=l.length;d<o;d++){var c=l[d],h=s[c[n]];if(h){for(var u={},v=!1,f=0,p=e.length;f<p;f++){var t=e[f];h.hasOwnProperty(t)?null!==(u[t]=h[t])&&(v=!0):u[t]=c[t]}v&&i.push(u)}}return i}if(0===arguments.length)return a.enableedit?JSON.stringify(a.editdatas):null;var n=a.datakey;r.isString(e)&&(e=this.getIndex(e,n));var c=a.datas[e];if(!c)return null;if(t||(t=n),a.enableedit){var h=a.editdatas[c[n]];if(h){var _=h[t];if(!r.isNull(_))return _}}return c[t]},setData:function(e,t,a){var i=this._property,l=i.datas[t];if(!l)return!1;var n=i.headers,d=null,o=0,c=null;if(r.isString(a)){for(var h=n.length;o<h&&(d=n[o]).name!==a;o++);o===h&&(d=!1)}else{if(!(d=n[o=a]))return!1;a=d.name}if(i.enableedit&&d&&d.editor){var u=l[i.datakey],f=i.editdatas;f=f[u]=f[u]||{},r.isNull(c=f[a])&&(c=l[a]),l=f}else c=l[a];if(c===e)return!1;l[a]=e,d&&s(d.render,i.dataTable.rows[t].cells[o],e,d.texts,a,o,t,this),this.emit("ondatachange",e,c,a,t)},getIndex:function(e,t,a){if(r.isNull(e))return-1;var i=this._property,l=i.datas;if(t)r.isArray(t)||(t=[t]);else{if(!0!==arguments[3]&&/^\d+$/.test(e)){var s=parseInt(e);if(!isNaN(s)&&s>=0&&s<l.length)return s}t=[i.datakey]}var n=parseInt(a)||0,d=l.length;if(i.enableedit)for(var o=i.datakey,h=i.editdatas;n<d;n++){var u=l[n],f=u[o],p=h[f];if(c(e,t,u,p))return n}else for(;n<d;n++)if(c(e,t,l[n],!1))return n;return-1},setHeaderVisible:function(e){var t=this._property;t.headervisible!==(e=!1!==e)&&((t.headervisible=e)?r.removeClass(t.container,"ui-list-no-header"):r.addClass(t.container,"ui-list-no-header"))},setColWidth:function(e,t){if(!((t=parseInt(t))<0)){var r=this._property,a=r.headers[t];if(a&&a.width!==(e=l(e)))return a.width=e,this.layout(),e}},enableEdit:function(e){e=!!e;var t=this._property;t.enableedit!==(e=!0===e)&&((t.enableedit=e)?t.editdatas={}:(this.flushData(),t.editdatas=null))},stopEdit:function(){var e=this._property;if(e.enableedit){var t=e.editor;t&&t.hide(!1)}},flushData:function(){var e=this._property;if(e.enableedit){var t=e._editConfig;if(t&&!1===t.obj.stop())return!1;var r=e.editdatas,a=e.datas,i=[e.datakey],l=a.length,s=null;for(var n in r)if(r.hasOwnProperty(n))for(var d=0;d<l;d++)if(c(n,i,s=a[d])){var o=r[n];for(var h in o)s[h]=o[h];break}e.editdatas={}}},enableSelected:function(e,t,r){var a=this._property;!0!==t&&!1!==t||(a.selectmultiple=t),!0!==r&&!1!==r||(a.selectautoclear=r),a.enableselect!==(e=!1!==e)&&((a.enableselect=e)?(a.selectedrows=[],a.selectedidxs=[]):(u(this,a),a.selectedrows=null,a.selectedidxs=null))},setSelected:function(e){var t=this._property;if(t.enableselect){var a=this.getIndex.apply(this,r.isNull(e)||r.isBoolean(e)?Array.prototype.slice.call(arguments,1):arguments);if(!1===e)return void u(this,t,-1===a?null:a);if(t.selectmultiple){if(!0!==e)if(t.selectautoclear)u(this,t);else if(-1!==t.selectedidxs.indexOf(a))return void u(this,t,a)}else u(this,t);if(-1!==a)return h(this,t,a),a}},getSelected:function(){var e=this._property;return e.enableselect?e.selectedidxs.concat():null},setOnSelect:function(e){var t=this._property;t.onselect=r.isFunction(e)?e:null,t.args4select=arguments[1]},scrollToView:function(e){if(-1!==(e=this.getIndex.apply(this,arguments))){var t=this._property,a=t.dataTable.rows[e],i=a.offsetTop,l=t.dataContainer,s=l.scrollTop,n=r.clientHeight(l);return i<s||i+r.clientHeight(a.cells[0])>s+n?l.scrollTop=i-n/2:void 0}},setRowStyle:function(e,t){var a=this._property,i=a.extrowstyles;if(r.isNull(e))v(i);else{var l=a.dataTable.rows[e];if(!l)return;if(v(i,l),!t)return;p(i,l,t)}}}),a});